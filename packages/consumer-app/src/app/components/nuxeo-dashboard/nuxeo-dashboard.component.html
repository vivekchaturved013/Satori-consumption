<div class="dashboard-container">
  
  <!-- Breadcrumbs Navigation -->
  <sat-breadcrumbs [items]="breadcrumbItems"></sat-breadcrumbs>
  
  <!-- Dashboard Header -->
  <ui-card 
    title="üöÄ Nuxeo Dashboard" 
    subtitle="Real-time data from Nuxeo API"
    icon="dashboard"
    variant="elevated"
    [headerActions]="true">
    
    <div slot="header-actions">
      <ui-button 
        variant="outline" 
        size="small"
        [disabled]="isAnyLoading()"
        [iconLeft]="isAnyLoading() ? 'refresh' : 'refresh'"
        (click)="refreshAllData()">
        {{ isAnyLoading() ? 'Loading...' : 'Refresh All' }}
      </ui-button>
    </div>
  </ui-card>

  <!-- Dashboard Grid Layout -->
  <div class="dashboard-grid">
    
    <!-- Recently Edited Section -->
    <ui-card 
      title="üìù Recently Edited" 
      subtitle="Your latest document activity"
      icon="edit"
      variant="outlined"
      [hoverable]="true">
      
      <!-- Search Header -->
      <div class="search-container">
        <div class="search-input-wrapper">
          <input 
            type="text" 
            class="search-input"
            placeholder="üîç Search documents, contributors, or types..."
            [value]="recentlyEditedSearch()"
            (input)="onRecentlyEditedSearch($any($event.target).value)"
          />
          @if (recentlyEditedSearch()) {
            <button 
              class="clear-search-btn"
              (click)="clearRecentlyEditedSearch()"
              title="Clear search">
              ‚úï
            </button>
          }
        </div>
        <div class="search-results-info">
          @if (recentlyEditedSearch()) {
            <small>{{ filteredRecentlyEdited().length }} of {{ recentlyEdited().length }} documents</small>
          }
        </div>
      </div>
      
      <div class="section-content">
        @if (isLoadingRecent()) {
          <div class="loading-state">
            <mat-spinner diameter="24"></mat-spinner>
            <p>Loading recently edited documents...</p>
          </div>
        } @else if (filteredRecentlyEdited().length > 0) {
          <table class="dashboard-table">
            <thead>
              <tr>
                <th class="title-column">Title</th>
                <th class="modified-column">Modified</th>
                <th class="contributor-column">Last Contributor</th>
              </tr>
            </thead>
            <tbody>
              @for (doc of filteredRecentlyEdited(); track doc.uid) {
                <tr class="table-row" (click)="onDocumentClick(doc)">
                  <td class="title-cell">
                    <div class="title-content">
                      <span class="document-icon">{{ getDocumentEmoji(doc.type) }}</span>
                      <span class="document-title">{{ doc.title }}</span>
                    </div>
                  </td>
                  <td class="modified-cell">
                    <sat-category-tag [category]="'blue'">{{ formatTimeAgo(doc.lastModified) }}</sat-category-tag>
                  </td>
                  <td class="contributor-cell">
                    <div class="contributor-info">
                      <sat-avatar 
                        [username]="doc.lastContributor"
                        [size]="'28'">
                        {{ getContributorInitials(doc.lastContributor) }}
                      </sat-avatar>
                      <span class="contributor-email">{{ doc.contributorEmail }}</span>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        } @else if (recentlyEditedSearch()) {
          <div class="empty-state">
            <p>üîç No documents found matching "{{ recentlyEditedSearch() }}"</p>
            <ui-button size="small" variant="ghost" (click)="clearRecentlyEditedSearch()">
              Clear Search
            </ui-button>
          </div>
        } @else {
          <div class="empty-state">
            <span>No recently edited documents</span>
          </div>
        }
      </div>
    </ui-card>

    <!-- Tasks Section -->
    <ui-card 
      title="üìã Tasks" 
      subtitle="Your workflow assignments"
      icon="task"
      variant="outlined"
      [hoverable]="true">
      
      <div class="section-content">
        <div class="empty-state">
          <p>‚úÖ You don't have any tasks to process at the moment.</p>
          <sat-status-tag [status]="'success'">All Clear</sat-status-tag>
        </div>
      </div>
    </ui-card>

    <!-- Recently Viewed Section -->
    <ui-card 
      title="üëÅÔ∏è Recently Viewed" 
      subtitle="Documents you've accessed recently"
      icon="visibility"
      variant="outlined"
      [hoverable]="true">
      
      <!-- Search Header -->
      <div class="search-container">
        <div class="search-input-wrapper">
          <input 
            type="text" 
            class="search-input"
            placeholder="üîç Search viewed documents..."
            [value]="recentlyViewedSearch()"
            (input)="onRecentlyViewedSearch($any($event.target).value)"
          />
          @if (recentlyViewedSearch()) {
            <button 
              class="clear-search-btn"
              (click)="clearRecentlyViewedSearch()"
              title="Clear search">
              ‚úï
            </button>
          }
        </div>
        <div class="search-results-info">
          @if (recentlyViewedSearch()) {
            <small>{{ filteredRecentlyViewed().length }} of {{ recentlyViewed().length }} documents</small>
          }
        </div>
      </div>
      
      <div class="section-content">
        @if (isLoadingViewed()) {
          <div class="loading-state">
            <mat-spinner diameter="24"></mat-spinner>
            <p>Loading recently viewed documents...</p>
          </div>
        } @else if (filteredRecentlyViewed().length > 0) {
          <table class="dashboard-table">
            <thead>
              <tr>
                <th class="title-column">Title</th>
                <th class="type-column">Type</th>
                <th class="viewed-column">Last Viewed</th>
              </tr>
            </thead>
            <tbody>
              @for (doc of filteredRecentlyViewed(); track doc.uid) {
                <tr class="table-row" (click)="onDocumentClick(doc)">
                  <td class="title-cell">
                    <div class="title-content">
                      <span class="document-icon">{{ getDocumentEmoji(doc.type) }}</span>
                      <span class="document-title">{{ doc.title }}</span>
                    </div>
                  </td>
                  <td class="type-cell">
                    <sat-category-tag [category]="'green'">{{ doc.type }}</sat-category-tag>
                  </td>
                  <td class="viewed-cell">{{ formatTimeAgo(doc.lastViewed || doc.lastModified) }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else if (recentlyViewedSearch()) {
          <div class="empty-state">
            <p>üîç No documents found matching "{{ recentlyViewedSearch() }}"</p>
            <ui-button size="small" variant="ghost" (click)="clearRecentlyViewedSearch()">
              Clear Search
            </ui-button>
          </div>
        } @else {
          <div class="empty-state">
            <span>No recently viewed documents</span>
          </div>
        }
      </div>
    </ui-card>

    <!-- Favorite Items Section -->
    <ui-card 
      title="‚≠ê Favorite Items" 
      subtitle="Your starred documents and collections"
      icon="star"
      variant="outlined"
      [hoverable]="true">
      
      <!-- Search Header -->
      <div class="search-container">
        <div class="search-input-wrapper">
          <input 
            type="text" 
            class="search-input"
            placeholder="üîç Search favorite items..."
            [value]="favoritesSearch()"
            (input)="onFavoritesSearch($any($event.target).value)"
          />
          @if (favoritesSearch()) {
            <button 
              class="clear-search-btn"
              (click)="clearFavoritesSearch()"
              title="Clear search">
              ‚úï
            </button>
          }
        </div>
        <div class="search-results-info">
          @if (favoritesSearch()) {
            <small>{{ filteredFavoriteItems().length }} of {{ favoriteItems().length }} items</small>
          }
        </div>
      </div>
      
      <div class="section-content">
        @if (isLoadingFavorites()) {
          <div class="loading-state">
            <mat-spinner diameter="24"></mat-spinner>
            <p>Loading favorite documents...</p>
          </div>
        } @else if (filteredFavoriteItems().length > 0) {
          <table class="dashboard-table">
            <thead>
              <tr>
                <th class="title-column">Title</th>
                <th class="modified-column">Modified</th>
                <th class="contributor-column">Last Contributor</th>
              </tr>
            </thead>
            <tbody>
              @for (doc of filteredFavoriteItems(); track doc.uid) {
                <tr class="table-row" (click)="onDocumentClick(doc)">
                  <td class="title-cell">
                    <div class="title-content">
                      <span class="document-icon">{{ getDocumentEmoji(doc.type) }}</span>
                      <span class="document-title">{{ doc.title }}</span>
                    </div>
                  </td>
                  <td class="modified-cell">
                    <sat-category-tag [category]="'purple'">{{ formatTimeAgo(doc.lastModified) }}</sat-category-tag>
                  </td>
                  <td class="contributor-cell">
                    <div class="contributor-info">
                      <sat-avatar 
                        [username]="doc.lastContributor"
                        [size]="'28'"
                        [indicator]="'active'">
                        {{ getContributorInitials(doc.lastContributor) }}
                      </sat-avatar>
                      <span class="contributor-email">{{ doc.contributorEmail }}</span>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        } @else if (favoritesSearch()) {
          <div class="empty-state">
            <p>üîç No favorite items found matching "{{ favoritesSearch() }}"</p>
            <ui-button size="small" variant="ghost" (click)="clearFavoritesSearch()">
              Clear Search
            </ui-button>
          </div>
        } @else {
          <div class="empty-state">
            <p>‚≠ê You haven't starred documents yet.</p>
            <sat-status-tag [status]="'info'">Start favoriting!</sat-status-tag>
          </div>
        }
      </div>
    </ui-card>

  </div>

  <!-- Document Browser Modal (only show when on dashboard route) -->
  @if (selectedDocument() && !router.url.startsWith('/browse')) {
    <app-document-browser 
      [document]="selectedDocument()!"
      [isVisible]="isDocumentBrowserOpen()"
      (closeRequested)="onDocumentBrowserClose()">
    </app-document-browser>
  }

</div>